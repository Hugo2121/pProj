Fri Oct 24 00:21:21 PDT 2014
 This script captures ICMP REDIRECT messages for a target host/network.
 The user is prompted to enter the target host, then the routing table of the host is modified so that instead of the default route, the seocond router attached to the subnetwork is used to reach the host/network.
 tracepath and route -Cn commands are used to display the current and modified routing table and path to the target host.
 Due to some technicalities, a list of targets in the immediate (clockwise) subnetwork, adjacent to the current host is displayed.
 tcpdump is used to capture the message and save it in a file "redirect.cap" and is displayed using tcpdump command.
 It is also possible to open and view the .cap file in Wireshark, if so desired.
 A log file of the execution of this script is saved in "log.redirect.txt" and can be viewed at a later date.
 Please enter a target host from the follwoing list: 
april
june
september
summer
fall
equinox
->


 You are currently running the script "redirect.sh" on "spring" with admin IP address: "192.168.0.20"
 "spring" belongs to subnetwork "net17" with IP address: "172.17.1.20"

 The target you chose is "equinox" with admin IP address: "192.168.0.16"
 "equinox" belongs to subnetowrk "net16" with IP address: "172.16.1.16"
 The default router from "spring" to "equinox" in "172.16.0.0/16" is "172.17.1.1".

 The default routing table of spring is: 
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
192.168.0.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
169.254.0.0     0.0.0.0         255.255.0.0     U     1000   0        0 eth0
172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 eth1
224.0.0.0       0.0.0.0         240.0.0.0       U     0      0        0 eth1
0.0.0.0         172.17.1.1      0.0.0.0         UG    100    0        0 eth1

 The default routing cache of spring is: 
Kernel IP routing cache
Source          Destination     Gateway         Flags Metric Ref    Use Iface
172.17.1.20     172.16.1.16     172.17.1.1            0      0        1 eth1
192.168.0.101   192.168.0.20    192.168.0.20    il    0      0       13 lo
192.168.0.100   192.168.0.20    192.168.0.20    il    0      0        5 lo
192.168.0.20    192.168.0.16    192.168.0.16          0      0        1 eth0
192.168.0.20    192.168.0.101   192.168.0.101         0      1        0 eth0
172.17.1.20     172.17.1.20     172.17.1.20     l     0      0        1 lo
192.168.0.16    192.168.0.20    192.168.0.20    il    0      0        1 lo
192.168.0.16    192.168.0.20    192.168.0.20    il    0      0        1 lo
192.168.0.20    192.168.0.100   192.168.0.100         0      0        4 eth0
172.17.1.20     224.0.0.251     224.0.0.251     ml    0      0       29 eth1
192.168.0.20    192.168.0.20    192.168.0.20    l     0      0        1 lo
172.17.1.20     224.0.0.22      224.0.0.22      m     0      0        0 eth1
192.168.0.20    192.168.0.16    192.168.0.16          0      0        0 eth0
10.0.0.0        224.0.0.1       224.0.0.1       ml    0      0        0 lo
172.17.1.20     224.0.0.251     224.0.0.251     ml    0      0        1 eth1
172.17.1.20     172.17.1.20     172.17.1.20     l     0      0        1 lo
172.17.1.2      172.17.1.20     172.17.1.20     il    0      0        0 lo
192.168.0.20    192.168.0.20    192.168.0.20    l     0      0        1 lo
172.16.1.16     172.17.1.20     172.17.1.20     l     0      0        1 lo

 The default path to equinox.net16 is: 
 1:  172.17.1.20       0.177ms pmtu 1500
 1:  172.17.1.1        0.373ms 
 1:  172.17.1.1        0.171ms 
 2:  172.16.1.16       0.781ms reached
     Resume: pmtu 1500 hops 2 back 61 

 Applying changes to the routing table.... 
 Process complete... 

 The modified path to equinox is: 
 1:  172.17.1.20       0.212ms pmtu 1500
 1:  172.17.1.2        0.346ms 
 1:  172.17.1.2        0.166ms 
 2:  172.17.1.1        0.515ms asymm  1 
 3:  172.16.1.16       1.024ms reached
     Resume: pmtu 1500 hops 3 back 61 

 The modified routing table of spring is: 
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
172.16.1.16     172.17.1.2      255.255.255.255 UGH   0      0        0 eth1
192.168.0.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
172.16.0.0      172.17.1.2      255.255.0.0     UG    0      0        0 eth1
169.254.0.0     0.0.0.0         255.255.0.0     U     1000   0        0 eth0
172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 eth1
224.0.0.0       0.0.0.0         240.0.0.0       U     0      0        0 eth1
0.0.0.0         172.17.1.1      0.0.0.0         UG    100    0        0 eth1

 The modified routing cache of spring is: 
Kernel IP routing cache
Source          Destination     Gateway         Flags Metric Ref    Use Iface
192.168.0.20    192.168.0.101   192.168.0.101         0      1        0 eth0
172.17.1.2      172.17.1.20     172.17.1.20     il    0      0        2 lo
172.17.1.20     172.16.1.16     172.17.1.1            0      0        2 eth1
192.168.0.101   192.168.0.20    192.168.0.20    il    0      0        8 lo
172.16.1.16     172.17.1.20     172.17.1.20     l     0      0        0 lo
192.168.0.100   192.168.0.20    192.168.0.20    il    0      0        0 lo
192.168.0.20    192.168.0.100   192.168.0.100         0      0        0 eth0
172.17.1.1      172.17.1.20     172.17.1.20     il    0      0        0 lo
172.17.1.20     172.17.1.20     172.17.1.20     l     0      0        0 lo

 The updated routing table of spring is: 
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
172.16.1.16     172.17.1.2      255.255.255.255 UGH   0      0        0 eth1
192.168.0.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
172.16.0.0      172.17.1.2      255.255.0.0     UG    0      0        0 eth1
169.254.0.0     0.0.0.0         255.255.0.0     U     1000   0        0 eth0
172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 eth1
224.0.0.0       0.0.0.0         240.0.0.0       U     0      0        0 eth1
0.0.0.0         172.17.1.1      0.0.0.0         UG    100    0        0 eth1

 The updated routing cache of spring is: 
Kernel IP routing cache
Source          Destination     Gateway         Flags Metric Ref    Use Iface
192.168.0.20    192.168.0.101   192.168.0.101         0      1        0 eth0
172.17.1.2      172.17.1.20     172.17.1.20     il    0      0        2 lo
172.17.1.20     172.16.1.16     172.17.1.1            0      0       14 eth1
192.168.0.101   192.168.0.20    192.168.0.20    il    0      0       16 lo
172.16.1.16     172.17.1.20     172.17.1.20     l     0      0        3 lo
192.168.0.100   192.168.0.20    192.168.0.20    il    0      0        4 lo
192.168.0.20    192.168.0.100   192.168.0.100         0      0        4 eth0
172.17.1.1      172.17.1.20     172.17.1.20     il    0      0        6 lo
172.17.1.20     172.17.1.20     172.17.1.20     l     0      0        3 lo

 The updated path to equinox is: 
 1:  172.17.1.20       0.351ms pmtu 1500
 1:  172.17.1.1        0.814ms 
 1:  172.17.1.1        0.255ms 
 2:  172.16.1.16       1.112ms reached
     Resume: pmtu 1500 hops 2 back 61 

 Restoring the routing table on "spring" to its original state.... 
 Process complete... 

 Displaying the captured message(s): 

00:22:09.250723 IP (tos 0xc0, ttl 64, id 36599, offset 0, flags [none], proto ICMP (1), length 576) february.net17 > spring.net17: ICMP redirect equinox.net16 to host january.net17, length 556
	IP (tos 0x0, ttl 1, id 0, offset 0, flags [DF], proto UDP (17), length 1500) spring.net17.50961 > equinox.net16.44446: UDP, length 1472
	0x0000:  0000 0001 0006 0050 56a4 6a0d 0000 0800  .......PV.j.....
	0x0010:  45c0 0240 8ef7 0000 4001 8ecd ac11 0102  E..@....@.......
	0x0020:  ac11 0114 0501 ae0b ac11 0101 4500 05dc  ............E...
	0x0030:  0000 4000 0111 19cc ac11 0114 ac10 0110  ..@.............
	0x0040:  c711 ad9e 05c8 5743 0200 0000 21fe 4954  ......WC....!.IT
	0x0050:  5dd2 0300 0000 0000 0000 0000 0000 0000  ]...............
	0x0060:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0070:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0080:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0090:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x00a0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x00b0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x00c0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x00d0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x00e0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x00f0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0100:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0110:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0120:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0130:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0140:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0150:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0160:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0170:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0180:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0190:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x01a0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x01b0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x01c0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x01d0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x01e0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x01f0:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0200:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0210:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0220:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0230:  0000 0000 0000 0000 0000 0000 0000 0000  ................
	0x0240:  0000 0000 0000 0000 0000 0000 0000 0000  ................
